ECHO OFF
CLS
CD \TMP
IF EXIST DOWNLOAD.OLD DEL DOWNLOAD.OLD
IF EXIST DOWNLOAD.BAK REN DOWNLOAD.BAK DOWNLOAD.OLD
IF EXIST DOWNLOAD.TXT REN DOWNLOAD.TXT DOWNLOAD.BAK
MV \PCB\MAIN\DOWNLOAD.TXT \TMP

COPY \PCB\GEN\DLPATH*.LST TRIMDL.CNF
REMOVE C: <TRIMDL.CNF | QSORT | UNIQUE >TRIMDL.CNF

U:\BIN\TRIMDL TRIMDL.CNF
IF ERRORLEVEL 1 GOTO FAIL
IF NOT EXIST DOWNLOAD.NEW GOTO FAIL

ECHO APPENDING NEW DOWNLOAD.TXT ENTRIES SINCE TRIMDL STARTED ...
IF EXIST \PCB\MAIN\DOWNLOAD.TXT TYPE \PCB\MAIN\DOWNLOAD.TXT >>DOWNLOAD.NEW
IF EXIST \PCB\MAIN\DOWNLOAD.TXT DEL \PCB\MAIN\DOWNLOAD.TXT
IF EXIST \PCB\MAIN\DOWNLOAD.NEW DEL \PCB\MAIN\DOWNLOAD.NEW

ECHO REPLACE ORIGINAL DOWNLOAD.TXT WITH TRIMMED VERSION ...
MV DOWNLOAD.NEW \PCB\MAIN
REN \PCB\MAIN\DOWNLOAD.NEW DOWNLOAD.TXT

ECHO RETAIN ORIGINAL DOWNLOAD.TXT AS DOWNLOAD.BAK ...
IF EXIST DOWNLOAD.BAK DEL DOWNLOAD.BAK
REN DOWNLOAD.TXT DOWNLOAD.BAK
IF EXIST \PCB\MAIN\DOWNLOAD.BAK DEL \PCB\MAIN\DOWNLOAD.BAK
MV DOWNLOAD.BAK \PCB\MAIN

IF EXIST \PCB\GEN\DLCOUNT.DAT DEL \PCB\GEN\DLCOUNT.DAT
GOTO EXIT

:FAIL
TYPE \PCB\MAIN\DOWNLOAD.TXT >>DOWNLOAD.TXT
MOVE DOWNLOAD.TXT \PCB\MAIN
ECHO ORIGINAL DOWNLOAD.TXT FILE RESTORED.

:EXIT
CD \PCB\MAIN
