
(*
 * Copyright 1987, 1989 Samuel H. Smith;  All rights reserved
 *
 * This is a component of the ProDoor System.
 * Do not distribute modified versions without my permission.
 * Do not remove or alter this notice or any other copyright notice.
 * If you use this in your own program you must distribute source code.
 * Do not use any of this in a commercial product.
 *
 *)

(*
 * ProSM4 - ProDoor System Manager - Generate PACKALL.BAT file (3-1-89)
 *
 *)

procedure generate_propack_batch;
var
   cn:   integer;
   fd:   text;

begin
   clear_screen;
   displn('Generate PACKALL.BAT ...');

   open_extconf_file;
   assign(fd,'PACKALL.BAT');
   {$i-} rewrite(fd); {$i+}
   if ioresult <> 0 then exit;

   writeln(fd,'rem PackAll.BAT generated by ProSM'^M^J'echo off');
   writeln(fd,'echo. >>PACKALL.LOG'^M^J'tm "Packall Started" >>PACKALL.LOG'^M^J'goto F%1'^M^J':F');

   for cn := 0 to maxcn-1 do
   begin
      load_conf(cn);
      if conf.conf_name <> '' then
      begin
         writeln(fd,^M^J':F',cn);
         writeln(fd,'ProPack ',conf.conf_msgfile,' ',conf.conf_packopt,' >>PACKALL.LOG');
         writeln(fd,'if errorlevel 1 goto exit'^M^J'if L%2 == L',cn,' goto exit');
      end;
   end;

   writeln(fd,^M^J':exit'^M^J'echo. >>PACKALL.LOG'^M^J'tm "Packall Ended" >>PACKALL.LOG');
   writeln(fd,'echo ---------- >>PACKALL.LOG');
   close(fd);
   close(confd);
end;

